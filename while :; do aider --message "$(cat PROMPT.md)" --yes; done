
…but implemented as a proper CLI tool with guardrails, better termination conditions, and support for externalized specs.

---

## Requirements

### Core loop (safe equivalent of the bash loop)
- [ ] Implement an iteration loop that repeatedly invokes `aider` with a prompt message.
- [ ] Add safety rails:
  - [ ] Configurable max iterations (sensible default).
  - [ ] Optional per-iteration timeout (sensible default: off).
  - [ ] Clean handling of Ctrl+C / SIGTERM (stop gracefully).
  - [ ] Optional delay between iterations (sensible default: 0).
  - [ ] Optional dry-run mode (prints what would run, does not execute).
  - [ ] Optional logging to a file.

### Termination conditions (more robust than plain text)
- [ ] Support a completion promise token that is unlikely to appear accidentally.
- [ ] Default completion promise should be:
  - `<promise>COMPLETED</promise>`
- [ ] The loop must stop when the completion promise is detected in aider output.

### Externalized specs + prompt template
- [ ] Allow the “specs” (the actual work request) to live in a separate specs file.
- [ ] Allow a separate prompt template file that wraps the specs in consistent instructions.
- [ ] Sensible defaults:
  - [ ] If a prompt template is not provided, use a sensible built-in default template.
  - [ ] If a `PROMPT.md` file exists and no prompt template override is provided, use `PROMPT.md`.
  - [ ] Specs file should be assumed by default; if missing / not specified, show help and exit non-zero.

### Iteration notes (forward progress between iterations)
- [ ] Encourage and support forwarding notes from one iteration to the next:
  - [ ] The tool should preserve and re-inject a “notes to next iteration” section (or similar mechanism).
  - [ ] The prompt should instruct aider to write concise notes for the next iteration when incomplete.

### Self-modification support
- [ ] aider-ralph must re-read any loaded files (prompt template, specs, notes, etc.) **every iteration** so that self-modification is permitted and takes effect immediately.

---

## Default Prompt Template Guidance (what the tool should send to aider)
The message sent to aider each iteration should:

1. Include the specs content (from the specs file).
2. Include the completion promise instruction:
   - When the work is fully complete, output exactly: `<promise>COMPLETED</promise>`
3. Include iteration discipline:
   - Implement one requirement at a time.
   - Write/adjust tests as needed.
   - Run tests and fix failures.
   - Keep changes small and reviewable.
4. Include “notes to next iteration” behavior:
   - If not complete, output a short “Notes for next iteration” section describing:
     - What was done
     - What remains
     - Any blockers
     - The next concrete step

---

## Success Criteria
When ALL of the following are true:
- All requirements implemented
- All tests passing
- Code reviewed and clean
- The tool reliably terminates only when the completion promise is emitted

---

## Completion
When complete, output exactly:

<promise>COMPLETED</promise>

If stuck after 10 iterations without progress:
- Document what's blocking
- List attempted solutions
- Suggest alternative approaches
- Output exactly: NEEDS_HUMAN_REVIEW
